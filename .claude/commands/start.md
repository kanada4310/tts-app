---
description: セッション開始時にプロジェクトの状態を把握する
---

# セッション開始プロトコル

## フェーズ1: 基本ドキュメント読み込み（必須）

以下のドキュメントを**順番に**読み込んでプロジェクトの状態を把握してください:

1. **docs/sessions/TODO.md** - 次に実施すべきタスク（最優先で確認）
2. **docs/sessions/SUMMARY.md** - 現在の実装状況と進捗
3. **docs/sessions/HANDOVER.md** - 詳細な作業履歴と技術的決定事項

## フェーズ1.5: 🔍 実装状況の実態確認（必須・最重要）

**⚠️ 重要警告: ドキュメントと実装の乖離を防ぐため、必ずこのステップを実行してください**

TODO.mdを読み込んだ後、**実装を開始する前に**、必ず以下を実行:

### ステップ1: 最近のコミット履歴を確認
```bash
git log --oneline -10
```

**確認ポイント:**
- 最近のコミットメッセージに、TODO.mdの未チェックタスクが含まれていないか
- 例: TODO.mdに「[ ] TTS進捗バー実装」とあるが、コミットに「TTS進捗バー実装完了」がある場合
  → **実装済みだがTODO.mdが更新されていない**可能性

### ステップ2: TODO.mdの未チェックタスクの実装確認

TODO.mdの最優先タスク（🔴マーク）が未チェック `[ ]` の場合、以下を**必ず実行**:

#### A. コミット履歴との照合
```bash
# 該当タスクのキーワードでコミット検索
# 例: "進捗バー" "日本語化" "チュートリアル"など
git log --oneline --all -20 | grep -i "[キーワード]"
```

**該当コミットが見つかった場合:**
```bash
# そのコミットの詳細を確認
git show --stat [commit-hash]
```
→ **実装済みと判定**、TODO.mdを更新する必要あり

#### B. 実装ファイルの直接確認

コミット履歴で判断できない場合、**該当機能の実装ファイルを直接読んで確認**:

**フロントエンド機能の場合:**
- 日本語化 → `frontend/src/constants/messages.ts` の存在確認
- 進捗バー → `frontend/src/components/features/TextEditor/TextEditor.tsx` の109-118行目付近を確認
- チュートリアル → `frontend/src/components/common/Tutorial/` の存在確認
- UI機能 → 該当コンポーネント（ImageUpload, TextEditor, AudioPlayer）を確認

**バックエンド機能の場合:**
- API → `backend/app/api/routes/` の該当ファイル
- サービス → `backend/app/services/` の該当ファイル

### ステップ3: ユーザーへの確認報告（必須）

実装状況を確認した後、**必ずユーザーに報告し、確認を得てから作業開始**:

```markdown
## 📋 セッション#[番号] 開始 - 実装状況確認

### TODO.mdの最優先タスク
- タスク名: [TODO.mdに記載のタスク]
- チェック状態: [ ] 未チェック

### 実装状況の実態確認結果

**コミット履歴の確認:**
- 最新5コミット: [コミットメッセージのリスト]
- 該当タスクのキーワード検索: [結果]

**実装ファイルの確認:**
- 確認したファイル: [ファイルパスと行数]
- 実装の有無: [✅実装済み / ❌未実装 / ⚠️部分実装]

### 判定結果

- ✅ **実装済み**: コードに存在するが、TODO.mdが更新されていない
  → **アクション**: TODO.mdを更新してから次のタスクへ

- ❌ **未実装**: コードに存在しない
  → **アクション**: タスク実装を開始

- ⚠️ **部分実装**: 一部のみ実装済み
  → **アクション**: 残りの実装範囲を特定してから作業開始

### 次のアクション提案
[具体的なアクション]

**ユーザーの確認をお願いします。この判定で正しいでしょうか？**
```

**⚠️ 絶対に守るルール:**
- ユーザーの確認を得る前に、実装を開始しない
- 疑わしい場合は、必ず追加でファイルを読んで確認する
- 「TODO.mdに書いてあるから未実装」と決めつけない

## フェーズ2: コンテキスト分析と追加ファイル判定

TODO.mdの最優先タスク（🔴マーク）を確認し、以下の判定ロジックに従って**自動的に追加ファイルを読み込む**:

### 判定ルール

#### ルール1: バックエンド関連タスクの場合
TODO.mdに以下のキーワードが含まれる場合:
- `OCR`, `TTS`, `API`, `エンドポイント`, `バックエンド`, `FastAPI`, `Python`

**追加で読み込むファイル:**
- `docs/API.md` - API仕様
- `backend/app/main.py` - FastAPIアプリ
- `backend/app/core/config.py` - 設定
- `backend/app/core/constants.py` - 定数
- TODO内容に応じて:
  - OCR関連 → `backend/app/api/routes/ocr.py`
  - TTS関連 → `backend/app/api/routes/tts.py`

#### ルール2: フロントエンド関連タスクの場合
TODO.mdに以下のキーワードが含まれる場合:
- `フロントエンド`, `React`, `コンポーネント`, `UI`, `画面`, `TypeScript`

**追加で読み込むファイル:**
- `frontend/src/App.tsx` - メインアプリ
- `frontend/src/constants/` - 定数ファイル群（特に messages.ts）
- `frontend/src/types/` - 型定義ファイル群
- TODO内容に応じて:
  - 画像アップロード → `frontend/src/components/features/ImageUpload/` (存在すれば)
  - テキスト編集 → `frontend/src/components/features/TextEditor/` (存在すれば)
  - 音声再生 → `frontend/src/components/features/AudioPlayer/` (存在すれば)

#### ルール3: インフラ・設定関連タスクの場合
TODO.mdに以下のキーワードが含まれる場合:
- `デプロイ`, `CI/CD`, `Docker`, `環境構築`, `インフラ`

**追加で読み込むファイル:**
- `docs/ARCHITECTURE.md` - アーキテクチャ
- `backend/.env.example` - 環境変数テンプレート
- `frontend/.env.example` - 環境変数テンプレート
- 存在すれば: `docker-compose.yml`, `.github/workflows/`

#### ルール4: ドキュメント・仕様関連タスクの場合
TODO.mdに以下のキーワードが含まれる場合:
- `仕様`, `ドキュメント`, `README`, `設計`

**追加で読み込むファイル:**
- `docs/SPECIFICATION.md` - 機能仕様
- `docs/ARCHITECTURE.md` - アーキテクチャ
- `PROJECT_STRUCTURE.md` - プロジェクト構造

#### ルール5: 新規機能実装の場合
TODO.mdに「新規」「追加」「実装」が含まれ、まだファイルが存在しない場合:

**追加で読み込むファイル:**
- `PROJECT_STRUCTURE.md` - ディレクトリ構造とコーディング規約
- `docs/SPECIFICATION.md` - 機能仕様
- 該当する既存の類似ファイル（参考実装として）

#### デフォルト（判定不能の場合）
上記のいずれにも該当しない、または複数の領域にまたがる場合:

**追加で読み込むファイル:**
- `docs/SPECIFICATION.md` - 機能仕様
- `docs/ARCHITECTURE.md` - アーキテクチャ
- `PROJECT_STRUCTURE.md` - プロジェクト構造

## フェーズ3: タスク開始前の確認

追加ファイルを読み込んだ後、以下を確認:

1. **依存関係のチェック**
   - 他のファイルや機能に影響がないか
   - 必要な定数や型が既に定義されているか

2. **コーディング規約の確認**
   - ファイルサイズ制限（200-300行）
   - 重複コードの有無
   - 定数・型の一元管理

3. **既存実装との整合性**
   - 似た機能が既に実装されていないか
   - 既存のパターンやアーキテクチャに従っているか

## フェーズ4: タスク実行

**ユーザーの確認を得た後**、TODO.mdの最優先タスク（🔴マーク）から作業を開始してください。

作業中は以下を意識:
- **段階的な実装**: 小さく分けて実装し、都度確認
- **テスト**: 可能な範囲でテストを書く
- **ドキュメント**: コードにコメントを追加

## フェーズ5: 作業完了時の更新（必須）

作業完了時は**必ず**以下を更新:

1. **TODO.md**
   - 完了タスクに✅チェックマークを追加
   - 新しく発生したタスクを追加
   - 優先度の見直し
   - **重要**: 実装したタスクは必ず全てチェックすること

2. **HANDOVER.md**
   - 実施内容の詳細
   - 技術的決定事項
   - 発生した問題と解決方法
   - 次回への引き継ぎ事項

3. **SUMMARY.md**
   - 進捗率の更新
   - 完了項目のチェック
   - 新規追加項目の記載

## 実行例

```
セッション開始 → /start

1. TODO.md読み込み
   → 最優先: "[ ] TTS進捗バー実装"

2. 実装状況確認（フェーズ1.5）
   → git log確認: "セッション#13: ユーザビリティ改善フェーズ1実装完了"発見
   → TextEditor.tsxの109-118行目確認: 進捗バー実装済み！
   → **判定: ✅実装済みだが、TODO.mdが更新されていない**

3. ユーザーへ報告
   → 「実装済みですが、TODO.mdが未更新です。更新してよろしいですか？」

4. ユーザー確認後、TODO.mdを更新
   → "[ ] TTS進捗バー実装" → "[x] TTS進捗バー実装 ✅"

5. 次の未実装タスクを確認して作業開始
```

## 注意事項

- ファイルが存在しない場合はスキップ（エラーにしない）
- 大量のファイル（10個以上）が必要な場合は、最も重要な5-7個に絞る
- 読み込んだファイルは必ず活用し、重複実装を避ける
- 不明点があれば、追加でファイルを読み込んでから作業開始
- **最重要**: 実装前に必ずユーザーの確認を得る
