# ä»Šå¾Œã®æ‹¡å¼µè¨­è¨ˆæ›¸ï¼ˆFuture Expansion Planï¼‰

**ä½œæˆæ—¥**: 2025-11-05
**å¯¾è±¡**: TTSå­¦ç¿’ã‚¢ãƒ—ãƒªã®é•·æœŸæ‹¡å¼µè¨ˆç”»
**ç›®çš„**: è‹±èªå­¦ç¿’ã®ç·åˆçš„ãªã‚¢ãƒ—ãƒªã¸ã®é€²åŒ–

---

## ğŸ“– ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ“ã‚¸ãƒ§ãƒ³](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ“ã‚¸ãƒ§ãƒ³)
2. [ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [Supabaseç§»è¡Œè¨ˆç”»](#supabaseç§»è¡Œè¨ˆç”»)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ)
5. [éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹](#éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹)
6. [èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ](#èªè¨¼ã‚·ã‚¹ãƒ†ãƒ )
7. [å°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µ](#å°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µ)
8. [å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](#å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—)
9. [ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š](#ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š)
10. [æŠ€è¡“çš„ãªæ³¨æ„äº‹é …](#æŠ€è¡“çš„ãªæ³¨æ„äº‹é …)

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ“ã‚¸ãƒ§ãƒ³

### æœ€çµ‚ç›®æ¨™

**è‹±èªå­¦ç¿’ã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãŸã‚ã®ç·åˆçš„ãªã‚¢ãƒ—ãƒª**

- é•·æ–‡OCR â†’ éŸ³èª­ç·´ç¿’ï¼ˆç¾åœ¨å®Ÿè£…æ¸ˆã¿ï¼‰
- å˜èªã®CEFRåˆ¤å®šãƒ»é »åº¦åˆ†æãƒ»å˜èªå¸³æ²è¼‰æƒ…å ±
- å˜èªãƒ»è¡¨ç¾ãƒ»æ§‹æ–‡ã®ã‚¹ãƒˆãƒƒã‚¯ç®¡ç†
- ã‚¹ãƒˆãƒƒã‚¯ã—ãŸå†…å®¹ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«éŸ³èª­ç·´ç¿’ã«ã¤ãªã’ã‚‹

### ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼

- é«˜æ ¡ç”Ÿï¼ˆå¤§å­¦å—é¨“ï¼‰
- å¤§å­¦ç”Ÿï¼ˆTOEICã€è‹±æ¤œï¼‰
- ç¤¾ä¼šäººï¼ˆãƒ“ã‚¸ãƒã‚¹è‹±èªï¼‰

---

## ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆï¼ˆ2025-11-05æ™‚ç‚¹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vercel)                                      â”‚
â”‚ - React + TypeScript + Vite                                 â”‚
â”‚ - ãƒ‡ãƒ¼ã‚¿ä¿å­˜: localStorage (ãƒ–ãƒ©ã‚¦ã‚¶ãƒ­ãƒ¼ã‚«ãƒ«)                â”‚
â”‚   - å­¦ç¿’è¨˜éŒ²ï¼ˆsessions, statsï¼‰                              â”‚
â”‚   - ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆbookmarksï¼‰                                â”‚
â”‚   - æ•™æãƒ‡ãƒ¼ã‚¿ï¼ˆmaterialText, materialSentencesï¼‰            â”‚
â”‚ - åˆ¶é™: 5-10MBã€å˜ä¸€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Railway)                                       â”‚
â”‚ - FastAPI + Python 3.11                                     â”‚
â”‚ - ã‚µãƒ¼ãƒ“ã‚¹:                                                  â”‚
â”‚   - Gemini OCR (è¤‡æ•°ç”»åƒã€æ–‡åˆ†å‰²)                            â”‚
â”‚   - OpenAI TTS (éŸ³å£°ç”Ÿæˆã€æ–‡ã”ã¨ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ)                â”‚
â”‚ - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: ãªã—ï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ï¼‰                          â”‚
â”‚ - éŸ³å£°ä¿å­˜: ãªã—ï¼ˆæ¯å›å†ç”Ÿæˆï¼‰                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¾åœ¨ã®åˆ¶é™äº‹é …

1. **ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–**
   - ãƒ–ãƒ©ã‚¦ã‚¶ã®localStorageã®ã¿ï¼ˆ5-10MBåˆ¶é™ï¼‰
   - ãƒ‡ãƒã‚¤ã‚¹é–“ã§åŒæœŸä¸å¯
   - ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã§ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±

2. **éŸ³å£°ç®¡ç†**
   - æ¯å›TTS APIã‚’å‘¼ã³å‡ºã—ï¼ˆã‚³ã‚¹ãƒˆå¢—ï¼‰
   - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å†ç”Ÿä¸å¯

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**
   - èªè¨¼æ©Ÿèƒ½ãªã—
   - ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œä¸å¯

4. **æ©Ÿèƒ½åˆ¶é™**
   - å˜èªåˆ†ææ©Ÿèƒ½ãªã—
   - å˜èªå¸³ç®¡ç†ãªã—

---

## Supabaseç§»è¡Œè¨ˆç”»

### ãªãœSupabaseï¼Ÿ

**Supabaseã®åˆ©ç‚¹:**
- âœ… PostgreSQLï¼ˆé«˜æ©Ÿèƒ½DBï¼‰
- âœ… èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ¡ãƒ¼ãƒ«ã€Googleã€GitHubç­‰ï¼‰
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆéŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- âœ… TypeScript SDKå®Œå‚™
- âœ… FastAPIã¨ç°¡å˜ã«çµ±åˆ
- âœ… ç„¡æ–™æ : 500MB DBã€50,000 æœˆé–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼

**ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ:**

| ã‚µãƒ¼ãƒ“ã‚¹ | DB | èªè¨¼ | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | ç„¡æ–™æ  | FastAPIçµ±åˆ |
|---------|-----|-----|-----------|-------|-------------|
| Supabase | PostgreSQL | âœ… | âœ… | 500MB | ç°¡å˜ |
| Firebase | Firestore | âœ… | âœ… | 1GB | è¤‡é›‘ |
| MongoDB Atlas | MongoDB | âŒ | âŒ | 512MB | æ™®é€š |

**çµè«–: Supabaseã‚’æ¨å¥¨**

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

#### 1. `users` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆSupabase AuthãŒè‡ªå‹•ç®¡ç†ï¼‰

```sql
-- Supabase AuthãŒè‡ªå‹•ç”Ÿæˆ
-- auth.users ãƒ†ãƒ¼ãƒ–ãƒ«
id UUID PRIMARY KEY
email TEXT UNIQUE
created_at TIMESTAMP
```

#### 2. `audio_cache` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…±æœ‰ï¼‰

```sql
CREATE TABLE audio_cache (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  text_hash TEXT UNIQUE NOT NULL,              -- SHA-256(text + voice + format)
  audio_url TEXT,                              -- çµåˆéŸ³å£°URLï¼ˆå˜ä¸€æ–‡ã®å ´åˆï¼‰
  segment_urls JSONB NOT NULL,                 -- æ–‡ã”ã¨ã®éŸ³å£°URLé…åˆ—
  durations JSONB NOT NULL,                    -- å„æ–‡ã®é•·ã•ï¼ˆç§’ï¼‰
  sentences JSONB NOT NULL,                    -- æ–‡ã®é…åˆ—
  format TEXT DEFAULT 'mp3' NOT NULL,
  voice TEXT DEFAULT 'alloy' NOT NULL,
  total_duration FLOAT NOT NULL,
  file_size_bytes BIGINT NOT NULL,
  access_count INT DEFAULT 1 NOT NULL,         -- å†åˆ©ç”¨å›æ•°
  created_at TIMESTAMP DEFAULT NOW(),
  last_accessed_at TIMESTAMP DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_audio_cache_text_hash ON audio_cache(text_hash);
CREATE INDEX idx_audio_cache_access_count ON audio_cache(access_count DESC);
CREATE INDEX idx_audio_cache_last_accessed ON audio_cache(last_accessed_at DESC);
```

**è¨­è¨ˆæ€æƒ³:**
- ãƒ†ã‚­ã‚¹ãƒˆ+éŸ³å£°è¨­å®šã®ãƒãƒƒã‚·ãƒ¥å€¤ã§é‡è¤‡æ¤œå‡º
- è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜æ•™æã‚’ä½¿ã†å ´åˆã€éŸ³å£°ã‚’å…±æœ‰ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
- `access_count`ã§äººæ°—æ•™æã‚’æŠŠæ¡
- `last_accessed_at`ã§å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è‡ªå‹•å‰Šé™¤

#### 3. `materials` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ï¼‰

```sql
CREATE TABLE materials (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title TEXT,                                  -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»˜ã‘ãŸã‚¿ã‚¤ãƒˆãƒ«
  ocr_text TEXT NOT NULL,                      -- OCRçµæœã®å…¨æ–‡
  sentences JSONB NOT NULL,                    -- æ–‡ã®é…åˆ—
  audio_cache_id UUID REFERENCES audio_cache(id), -- éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¸ã®å‚ç…§
  source_type TEXT DEFAULT 'ocr',              -- 'ocr', 'manual', 'import'
  tags TEXT[],                                 -- ã‚¿ã‚°ï¼ˆä¾‹: ['TOEIC', 'é•·æ–‡èª­è§£']ï¼‰
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_materials_user_id ON materials(user_id);
CREATE INDEX idx_materials_created_at ON materials(created_at DESC);
CREATE INDEX idx_materials_tags ON materials USING GIN(tags);

-- RLS (Row Level Security)
ALTER TABLE materials ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own materials"
  ON materials FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own materials"
  ON materials FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own materials"
  ON materials FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete their own materials"
  ON materials FOR DELETE
  USING (auth.uid() = user_id);
```

#### 4. `bookmarks` ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE bookmarks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  material_id UUID REFERENCES materials(id) ON DELETE CASCADE,
  sentence_index INT NOT NULL,                 -- æ–‡ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0å§‹ã¾ã‚Šï¼‰
  sentence_text TEXT NOT NULL,                 -- æ–‡ã®å…¨æ–‡
  mastery_level INT DEFAULT 1 NOT NULL CHECK (mastery_level BETWEEN 1 AND 5),
  note TEXT,
  practice_count INT DEFAULT 0 NOT NULL,
  last_practiced_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),

  -- è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼ˆåŒã˜æ•™æã®åŒã˜æ–‡ã‚’è¤‡æ•°å›ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãªã„ï¼‰
  UNIQUE (user_id, material_id, sentence_index)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_bookmarks_user_id ON bookmarks(user_id);
CREATE INDEX idx_bookmarks_material_id ON bookmarks(material_id);
CREATE INDEX idx_bookmarks_mastery_level ON bookmarks(mastery_level);
CREATE INDEX idx_bookmarks_created_at ON bookmarks(created_at DESC);

-- RLS
ALTER TABLE bookmarks ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own bookmarks"
  ON bookmarks FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own bookmarks"
  ON bookmarks FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own bookmarks"
  ON bookmarks FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete their own bookmarks"
  ON bookmarks FOR DELETE
  USING (auth.uid() = user_id);
```

#### 5. `learning_sessions` ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE learning_sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  material_id UUID REFERENCES materials(id) ON DELETE SET NULL,
  start_time TIMESTAMP NOT NULL,
  end_time TIMESTAMP,
  play_count INT DEFAULT 0 NOT NULL,
  repeat_count INT DEFAULT 0 NOT NULL,
  total_duration INT DEFAULT 0 NOT NULL,       -- ç§’
  sentence_practice_counts JSONB,              -- { "0": 5, "1": 3, ... }
  bookmarked_count INT DEFAULT 0 NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_learning_sessions_user_id ON learning_sessions(user_id);
CREATE INDEX idx_learning_sessions_start_time ON learning_sessions(start_time DESC);
CREATE INDEX idx_learning_sessions_material_id ON learning_sessions(material_id);

-- RLS
ALTER TABLE learning_sessions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own sessions"
  ON learning_sessions FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own sessions"
  ON learning_sessions FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own sessions"
  ON learning_sessions FOR UPDATE
  USING (auth.uid() = user_id);
```

#### 6. `vocabulary` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå˜èªå¸³ã€å°†æ¥ã®æ‹¡å¼µï¼‰

```sql
CREATE TABLE vocabulary (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  word TEXT NOT NULL,
  meaning TEXT,
  example_sentence TEXT,
  material_id UUID REFERENCES materials(id) ON DELETE SET NULL, -- å‡ºå…¸æ•™æ
  sentence_index INT,                          -- å‡ºå…¸æ–‡ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  cefr_level TEXT CHECK (cefr_level IN ('A1', 'A2', 'B1', 'B2', 'C1', 'C2')),
  frequency_rank INT,                          -- é »åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆ1-10000ï¼‰
  in_wordlists TEXT[],                         -- ['TOEIC', 'è‹±æ¤œæº–1ç´š', ...]
  tags TEXT[],                                 -- ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°
  mastery_level INT DEFAULT 1 CHECK (mastery_level BETWEEN 1 AND 5),
  next_review_date DATE,                       -- æ¬¡å›å¾©ç¿’æ—¥ï¼ˆé–“éš”åå¾©å­¦ç¿’ï¼‰
  practice_count INT DEFAULT 0 NOT NULL,
  last_practiced_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),

  -- è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼ˆåŒã˜å˜èªã‚’è¤‡æ•°å›ç™»éŒ²ã—ãªã„ï¼‰
  UNIQUE (user_id, word)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_vocabulary_user_id ON vocabulary(user_id);
CREATE INDEX idx_vocabulary_cefr_level ON vocabulary(cefr_level);
CREATE INDEX idx_vocabulary_mastery_level ON vocabulary(mastery_level);
CREATE INDEX idx_vocabulary_next_review_date ON vocabulary(next_review_date);
CREATE INDEX idx_vocabulary_tags ON vocabulary USING GIN(tags);

-- RLS
ALTER TABLE vocabulary ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own vocabulary"
  ON vocabulary FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own vocabulary"
  ON vocabulary FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own vocabulary"
  ON vocabulary FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete their own vocabulary"
  ON vocabulary FOR DELETE
  USING (auth.uid() = user_id);
```

---

## éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰                                               â”‚
â”‚  1. éŸ³å£°ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆtext, sentences, voice, formatï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (FastAPI)                                       â”‚
â”‚  2. ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒã‚·ãƒ¥è¨ˆç®— (SHA-256)                           â”‚
â”‚  3. audio_cache ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆï¼Ÿ
        Yes â†“                                    No â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰éŸ³å£°å–å¾—  â”‚            â”‚ OpenAI TTS APIå‘¼ã³å‡ºã—  â”‚
â”‚  - segment_urlsè¿”å´     â”‚            â”‚  - éŸ³å£°ç”Ÿæˆï¼ˆæ–°è¦ï¼‰      â”‚
â”‚  - access_count++      â”‚            â”‚  - Supabase Storageã«   â”‚
â”‚  - last_accessedæ›´æ–°    â”‚            â”‚    ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  - audio_cacheã«ä¿å­˜    â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Storage                                            â”‚
â”‚  - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: audio/{text_hash}/segment_{index}.mp3       â”‚
â”‚  - å…¬é–‹URLç”Ÿæˆ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰                                               â”‚
â”‚  - éŸ³å£°URLé…åˆ—ã‚’å—ã‘å–ã‚Š                                      â”‚
â”‚  - AudioPlayerã§å†ç”Ÿ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Ÿè£…ã‚³ãƒ¼ãƒ‰ä¾‹

```python
# backend/app/services/audio_cache_service.py
import hashlib
from supabase import create_client

async def get_or_create_audio(
    text: str,
    sentences: list,
    voice: str,
    format: str
):
    # 1. ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¨ˆç®—
    hash_input = f"{text}:{voice}:{format}"
    text_hash = hashlib.sha256(hash_input.encode()).hexdigest()

    # 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¤œç´¢
    cached = await supabase.from_('audio_cache') \
        .select('*') \
        .eq('text_hash', text_hash) \
        .single() \
        .execute()

    if cached.data:
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ
        await supabase.from_('audio_cache') \
            .update({
                'access_count': cached.data['access_count'] + 1,
                'last_accessed_at': 'NOW()'
            }) \
            .eq('id', cached.data['id']) \
            .execute()

        return {
            'segment_urls': cached.data['segment_urls'],
            'durations': cached.data['durations'],
            'cached': True
        }

    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹: æ–°è¦ç”Ÿæˆ
    audio_blobs, durations = await generate_speech_separated(
        text, sentences, voice, format
    )

    # 3. Supabase Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    segment_urls = []
    total_size = 0

    for i, blob in enumerate(audio_blobs):
        file_path = f"audio/{text_hash}/segment_{i}.{format}"

        # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        await supabase.storage \
            .from_('audio-files') \
            .upload(file_path, blob)

        # å…¬é–‹URLå–å¾—
        url = supabase.storage \
            .from_('audio-files') \
            .get_public_url(file_path)

        segment_urls.append(url)
        total_size += len(blob)

    # 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    cache_entry = {
        'text_hash': text_hash,
        'segment_urls': segment_urls,
        'durations': durations,
        'sentences': sentences,
        'format': format,
        'voice': voice,
        'total_duration': sum(durations),
        'file_size_bytes': total_size
    }

    await supabase.from_('audio_cache') \
        .insert(cache_entry) \
        .execute()

    return {
        'segment_urls': segment_urls,
        'durations': durations,
        'cached': False
    }
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤ãƒãƒªã‚·ãƒ¼

```sql
-- 90æ—¥é–“ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¦ã„ãªã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ï¼ˆé€±æ¬¡ãƒãƒƒãƒï¼‰
DELETE FROM audio_cache
WHERE last_accessed_at < NOW() - INTERVAL '90 days';

-- ã¾ãŸã¯ã€access_count=1ï¼ˆä¸€åº¦ã—ã‹ä½¿ã‚ã‚Œã¦ã„ãªã„ï¼‰ã‚’å‰Šé™¤
DELETE FROM audio_cache
WHERE access_count = 1
  AND last_accessed_at < NOW() - INTERVAL '30 days';
```

---

## èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### Supabase Authçµ±åˆ

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰

```typescript
// frontend/src/services/auth/supabaseClient.ts
import { createClient } from '@supabase/supabase-js'

const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL
const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

// ãƒ­ã‚°ã‚¤ãƒ³
export async function signIn(email: string, password: string) {
  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password,
  })

  if (error) throw error
  return data
}

// ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
export async function signUp(email: string, password: string) {
  const { data, error } = await supabase.auth.signUp({
    email,
    password,
  })

  if (error) throw error
  return data
}

// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
export async function signOut() {
  const { error } = await supabase.auth.signOut()
  if (error) throw error
}

// ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
export async function getCurrentUser() {
  const { data: { user } } = await supabase.auth.getUser()
  return user
}
```

#### Protected Routes

```typescript
// frontend/src/components/ProtectedRoute.tsx
import { useEffect, useState } from 'react'
import { Navigate } from 'react-router-dom'
import { getCurrentUser } from '@/services/auth/supabaseClient'

export function ProtectedRoute({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    getCurrentUser().then((user) => {
      setUser(user)
      setLoading(false)
    })
  }, [])

  if (loading) return <div>Loading...</div>
  if (!user) return <Navigate to="/login" />

  return <>{children}</>
}
```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆFastAPIï¼‰

```python
# backend/app/core/auth.py
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from supabase import create_client

security = HTTPBearer()

async def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security)
):
    """
    JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã¦ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    """
    token = credentials.credentials

    try:
        # Supabaseã§ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
        user = supabase.auth.get_user(token)
        return user
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid authentication credentials",
            headers={"WWW-Authenticate": "Bearer"},
        )

# ä½¿ç”¨ä¾‹
@router.post("/api/materials")
async def create_material(
    data: MaterialCreate,
    current_user = Depends(get_current_user)
):
    # current_user.id ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
    material = await create_material_in_db(data, current_user.id)
    return material
```

---

## å°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µ

### ãƒ•ã‚§ãƒ¼ã‚º3: å˜èªåˆ†ææ©Ÿèƒ½

#### æ©Ÿèƒ½æ¦‚è¦

- é•·æ–‡ä¸­ã®å˜èªã‚’CEFRãƒ¬ãƒ™ãƒ«ï¼ˆA1-C2ï¼‰ã§åˆ¤å®š
- é »åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºï¼ˆBNC/COCAã‚³ãƒ¼ãƒ‘ã‚¹ï¼‰
- å˜èªå¸³æ²è¼‰æƒ…å ±ï¼ˆTOEICã€è‹±æ¤œã€å¤§å­¦å—é¨“å˜èªå¸³ï¼‰

#### å®Ÿè£…æ–¹æ³•

**å¤–éƒ¨APIçµ±åˆ:**

1. **Oxford Dictionary API** (æœ‰æ–™)
   - CEFRåˆ¤å®š
   - å®šç¾©ã€ä¾‹æ–‡
   - æœˆé¡: $500ï¼ˆ50,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰

2. **Cambridge Dictionary API** (æœ‰æ–™)
   - CEFRåˆ¤å®š
   - ç™ºéŸ³ã€éŸ³å£°

3. **ä»£æ›¿æ¡ˆ: è‡ªå‰ã®CEFRãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**
   - ç„¡æ–™ã®CEFRãƒªã‚¹ãƒˆï¼ˆç´„10,000èªï¼‰
   - `vocabulary_reference`ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ

```sql
CREATE TABLE vocabulary_reference (
  word TEXT PRIMARY KEY,
  cefr_level TEXT NOT NULL,
  frequency_rank INT,
  in_wordlists TEXT[],
  part_of_speech TEXT,
  definition TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆCSV importãªã©ï¼‰
COPY vocabulary_reference(word, cefr_level, frequency_rank, in_wordlists)
FROM '/path/to/cefr_wordlist.csv'
WITH (FORMAT csv, HEADER true);
```

#### APIè¨­è¨ˆ

```python
# backend/app/api/routes/vocabulary.py
from fastapi import APIRouter, Depends

router = APIRouter()

@router.post("/api/analyze-vocabulary")
async def analyze_vocabulary(
    text: str,
    current_user = Depends(get_current_user)
):
    """
    ãƒ†ã‚­ã‚¹ãƒˆã‚’è§£æã—ã¦å˜èªæƒ…å ±ã‚’è¿”ã™
    """
    # 1. ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒˆãƒ¼ã‚¯ãƒ³åŒ–
    words = tokenize(text)

    # 2. å„å˜èªã®æƒ…å ±ã‚’å–å¾—
    results = []
    for word in words:
        info = await get_word_info(word)
        results.append({
            'word': word,
            'cefr_level': info.cefr_level,
            'frequency_rank': info.frequency_rank,
            'in_wordlists': info.in_wordlists,
            'is_known': await check_if_user_knows(current_user.id, word)
        })

    return {
        'total_words': len(words),
        'unique_words': len(set(words)),
        'words': results,
        'cefr_distribution': calculate_cefr_distribution(results)
    }
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆUIï¼‰

```typescript
// frontend/src/components/features/VocabularyAnalysis/VocabularyAnalysis.tsx
interface VocabularyInfo {
  word: string
  cefr_level: string
  frequency_rank: number
  in_wordlists: string[]
  is_known: boolean
}

export function VocabularyAnalysis({ text }: { text: string }) {
  const [analysis, setAnalysis] = useState(null)

  const handleAnalyze = async () => {
    const result = await analyzeVocabulary(text)
    setAnalysis(result)
  }

  return (
    <div>
      <button onClick={handleAnalyze}>å˜èªåˆ†æ</button>

      {analysis && (
        <div>
          <h3>CEFRåˆ†å¸ƒ</h3>
          <CEFRChart distribution={analysis.cefr_distribution} />

          <h3>å˜èªãƒªã‚¹ãƒˆ</h3>
          {analysis.words.map((word) => (
            <div key={word.word} className={`word-${word.cefr_level}`}>
              <span>{word.word}</span>
              <span>{word.cefr_level}</span>
              <span>é »åº¦: {word.frequency_rank}</span>
              {word.in_wordlists.length > 0 && (
                <span>{word.in_wordlists.join(', ')}</span>
              )}
              <button onClick={() => addToVocabulary(word)}>
                å˜èªå¸³ã«è¿½åŠ 
              </button>
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
```

---

### ãƒ•ã‚§ãƒ¼ã‚º4: å˜èªå¸³ãƒ»ã‚¹ãƒˆãƒƒã‚¯æ©Ÿèƒ½

#### æ©Ÿèƒ½æ¦‚è¦

- ã‚«ã‚¹ã‚¿ãƒ å˜èªå¸³ä½œæˆ
- ã‚¿ã‚°ä»˜ã‘ãƒ»ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
- é–“éš”åå¾©å­¦ç¿’ï¼ˆSpaced Repetitionï¼‰
- ä¾‹æ–‡ã‹ã‚‰éŸ³å£°ç”Ÿæˆ

#### é–“éš”åå¾©ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆSM-2ï¼‰

```typescript
// frontend/src/utils/spacedRepetition.ts
interface ReviewSchedule {
  interval: number // æ¬¡å›å¾©ç¿’ã¾ã§ã®æ—¥æ•°
  easeFactor: number // é›£æ˜“åº¦ï¼ˆ1.3-2.5ï¼‰
  repetitions: number // é€£ç¶šæ­£è§£å›æ•°
}

export function calculateNextReview(
  current: ReviewSchedule,
  quality: number // 0-5 (0: å…¨ãè¦šãˆã¦ã„ãªã„, 5: å®Œç’§)
): ReviewSchedule {
  let { interval, easeFactor, repetitions } = current

  // Ease Factorã‚’æ›´æ–°
  easeFactor = Math.max(
    1.3,
    easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))
  )

  // Intervalã‚’æ›´æ–°
  if (quality < 3) {
    // ä¸æ­£è§£: ãƒªã‚»ãƒƒãƒˆ
    repetitions = 0
    interval = 1
  } else {
    // æ­£è§£
    repetitions++

    if (repetitions === 1) {
      interval = 1
    } else if (repetitions === 2) {
      interval = 6
    } else {
      interval = Math.round(interval * easeFactor)
    }
  }

  return {
    interval,
    easeFactor,
    repetitions,
  }
}
```

---

### ãƒ•ã‚§ãƒ¼ã‚º5: éŸ³èª­ç·´ç¿’çµ±åˆ

#### æ©Ÿèƒ½æ¦‚è¦

- å˜èªå¸³ã‹ã‚‰ã‚«ã‚¹ã‚¿ãƒ éŸ³å£°æ•™æä½œæˆ
- ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ã¿ã‚’éŸ³å£°åŒ–
- ç¿’å¾—åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆæ˜Ÿ1-2ã®ã¿ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆæ©Ÿèƒ½

#### å®Ÿè£…ä¾‹

```typescript
// frontend/src/components/features/CustomPlaylist/CustomPlaylist.tsx
export function CustomPlaylist() {
  const [bookmarks, setBookmarks] = useState([])
  const [filter, setFilter] = useState({ masteryLevel: [1, 2] })

  const handleGeneratePlaylist = async () => {
    // 1. ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const filtered = bookmarks.filter((b) =>
      filter.masteryLevel.includes(b.masteryLevel)
    )

    // 2. æ–‡ã‚’çµåˆ
    const sentences = filtered.map((b) => b.sentenceText)
    const text = sentences.join(' ')

    // 3. éŸ³å£°ç”Ÿæˆ
    const { segment_urls, durations } = await performTTSSeparated(
      text,
      sentences,
      'alloy',
      'mp3'
    )

    // 4. AudioPlayerã§å†ç”Ÿ
    setAudioSegments(segment_urls)
    setSegmentDurations(durations)
  }

  return (
    <div>
      <h2>ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ</h2>

      <label>
        ç¿’å¾—åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:
        <select onChange={(e) => setFilter({ masteryLevel: [parseInt(e.target.value)] })}>
          <option value="1,2">è¦å¾©ç¿’ï¼ˆæ˜Ÿ1-2ï¼‰</option>
          <option value="3,4">ç¿’å¾—ä¸­ï¼ˆæ˜Ÿ3-4ï¼‰</option>
          <option value="5">ç¿’å¾—æ¸ˆã¿ï¼ˆæ˜Ÿ5ï¼‰</option>
        </select>
      </label>

      <button onClick={handleGeneratePlaylist}>
        éŸ³å£°ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆç”Ÿæˆ
      </button>
    </div>
  )
}
```

---

## å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### å…¨ä½“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæ¨å®šï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | ã‚¿ã‚¹ã‚¯ | æ‰€è¦æ™‚é–“ | å„ªå…ˆåº¦ |
|---------|-------|---------|-------|
| **ãƒ•ã‚§ãƒ¼ã‚º1** | Supabaseã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»èªè¨¼ | 1-2é€±é–“ | ğŸ”´ æœ€å„ªå…ˆ |
| **ãƒ•ã‚§ãƒ¼ã‚º2** | ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ»éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | 1é€±é–“ | ğŸ”´ æœ€å„ªå…ˆ |
| **ãƒ•ã‚§ãƒ¼ã‚º3** | å˜èªåˆ†ææ©Ÿèƒ½ | 1é€±é–“ | ğŸŸ¡ é«˜å„ªå…ˆ |
| **ãƒ•ã‚§ãƒ¼ã‚º4** | å˜èªå¸³ãƒ»ã‚¹ãƒˆãƒƒã‚¯æ©Ÿèƒ½ | 1é€±é–“ | ğŸŸ¡ é«˜å„ªå…ˆ |
| **ãƒ•ã‚§ãƒ¼ã‚º5** | éŸ³èª­ç·´ç¿’çµ±åˆ | 1é€±é–“ | ğŸŸ¢ ä¸­å„ªå…ˆ |

**åˆè¨ˆ: 5-7é€±é–“**

---

### ãƒ•ã‚§ãƒ¼ã‚º1: Supabaseã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»èªè¨¼ï¼ˆ1-2é€±é–“ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—1: Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆï¼ˆ1æ—¥ï¼‰

1. https://supabase.com ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
2. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
3. PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è‡ªå‹•è¨­å®š
4. API keyså–å¾—

#### ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆ1æ—¥ï¼‰

```sql
-- ä¸Šè¨˜ã®ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã‚’å®Ÿè¡Œ
-- audio_cache, materials, bookmarks, learning_sessions, vocabulary
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: èªè¨¼UIå®Ÿè£…ï¼ˆ2-3æ—¥ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `frontend/src/pages/Login.tsx`
- `frontend/src/pages/SignUp.tsx`
- `frontend/src/components/ProtectedRoute.tsx`

#### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èªè¨¼çµ±åˆï¼ˆ2-3æ—¥ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `backend/app/core/auth.py`
- `backend/app/api/routes/auth.py`

#### ã‚¹ãƒ†ãƒƒãƒ—5: localStorage â†’ Supabaseç§»è¡Œãƒ„ãƒ¼ãƒ«ï¼ˆ2æ—¥ï¼‰

```typescript
// frontend/src/utils/migration.ts
export async function migrateLearningDataToSupabase() {
  // 1. localStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
  const localData = LearningService.getLearningData()

  // 2. Supabaseã«ç§»è¡Œ
  for (const session of localData.sessions) {
    await supabase.from('learning_sessions').insert({
      user_id: currentUser.id,
      start_time: session.startTime,
      end_time: session.endTime,
      play_count: session.playCount,
      // ...
    })
  }

  for (const bookmark of localData.bookmarks) {
    // 1. æ•™æã‚’ä½œæˆ
    const { data: material } = await supabase.from('materials').insert({
      user_id: currentUser.id,
      title: bookmark.materialText.substring(0, 50),
      ocr_text: bookmark.materialText,
      sentences: bookmark.materialSentences,
    }).select().single()

    // 2. ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ä½œæˆ
    await supabase.from('bookmarks').insert({
      user_id: currentUser.id,
      material_id: material.id,
      sentence_index: bookmark.sentenceIndex,
      sentence_text: bookmark.sentenceText,
      mastery_level: bookmark.masteryLevel,
      note: bookmark.note,
    })
  }

  // 3. localStorageã‚¯ãƒªã‚¢
  localStorage.removeItem('tts_learning_data')
}
```

---

### ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ»éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ1é€±é–“ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—1: Supabase Storageè¨­å®šï¼ˆ1æ—¥ï¼‰

1. Storageãƒã‚±ãƒƒãƒˆä½œæˆ: `audio-files`
2. å…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹è¨­å®š
3. CORSè¨­å®š

#### ã‚¹ãƒ†ãƒƒãƒ—2: éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ï¼ˆ2-3æ—¥ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `backend/app/services/audio_cache_service.py`
- `backend/app/api/routes/tts.py`ï¼ˆæ›´æ–°ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰APIçµ±åˆï¼ˆ2æ—¥ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `frontend/src/services/api/tts.ts`ï¼ˆæ›´æ–°ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—4: æ—¢å­˜æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆï¼ˆ1æ—¥ï¼‰

- éŸ³å£°ç”Ÿæˆ
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ/ãƒŸã‚¹ç¢ºèª
- ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½

---

### ãƒ•ã‚§ãƒ¼ã‚º3-5: å˜èªåˆ†æãƒ»å˜èªå¸³ãƒ»éŸ³èª­ç·´ç¿’çµ±åˆ

ï¼ˆè©³ç´°ã¯ä¸Šè¨˜ã‚’å‚ç…§ï¼‰

---

## ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

### Supabaseï¼ˆæ¨å¥¨ãƒ—ãƒ©ãƒ³: Pro $25/æœˆï¼‰

| é …ç›® | ç„¡æ–™æ  | Pro ($25/æœˆ) | è¶…éæ–™é‡‘ |
|------|-------|-------------|---------|
| DBå®¹é‡ | 500MB | 8GB | $0.125/GB/æœˆ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | 1GB | 100GB | $0.021/GB/æœˆ |
| å¸¯åŸŸå¹… | 5GB | 250GB | $0.09/GB |
| æœˆé–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ | 50,000 | ç„¡åˆ¶é™ | - |

**è©¦ç®—ï¼ˆ100ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€æœˆ100æ•™æï¼‰:**
- DB: 100æ•™æ Ã— 10KB = 1MBï¼ˆç„¡æ–™æ å†…ï¼‰
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 100æ•™æ Ã— 30KB Ã— 100æ–‡ = 300MBï¼ˆç„¡æ–™æ å†…ï¼‰
- å¸¯åŸŸå¹…: 100æ•™æ Ã— 30KB Ã— 10å†ç”Ÿ = 30MBï¼ˆç„¡æ–™æ å†…ï¼‰

**çµè«–: ç„¡æ–™æ ã§ååˆ†ã€‚Pro ($25/æœˆ)ã¯å°†æ¥çš„ã«æ¤œè¨**

---

### Railwayï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

**ç¾åœ¨**: $5/æœˆï¼ˆHobby Planï¼‰
**å°†æ¥**: $20/æœˆï¼ˆPro Planï¼‰

---

### OpenAI TTS API

**æ–™é‡‘**: $15 / 1Mæ–‡å­—

**è©¦ç®—:**
- 1æ•™æ: 5,000æ–‡å­—
- 100æ•™æ: 500,000æ–‡å­— = **$7.50**
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡75%ã®å ´åˆ: **$1.88/æœˆ**

---

### **åˆè¨ˆæœˆé¡ã‚³ã‚¹ãƒˆ**

| é …ç›® | ç¾åœ¨ | å°†æ¥ï¼ˆProï¼‰ |
|------|------|-----------|
| Supabase | $0 | $25 |
| Railway | $5 | $20 |
| OpenAI TTS | $2 | $5 |
| **åˆè¨ˆ** | **$7/æœˆ** | **$50/æœˆ** |

---

## æŠ€è¡“çš„ãªæ³¨æ„äº‹é …

### ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæ™‚ã®æ³¨æ„ç‚¹

1. **localStorageã‹ã‚‰Supabaseã¸ã®ç§»è¡Œ**
   - ç§»è¡Œå®Œäº†å¾Œã‚‚localStorageã‚’ä¸€å®šæœŸé–“ä¿æŒï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
   - ç§»è¡Œãƒ•ãƒ©ã‚°ã‚’è¨­å®šï¼ˆ`migration_completed: true`ï¼‰

2. **æ—¢å­˜ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®äº’æ›æ€§**
   - æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ`materialId`, `sentenceIndex`ï¼‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã®å‡¦ç†

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

1. **éŸ³å£°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€é©åŒ–**
   - CDNçµ±åˆï¼ˆCloudflare, CloudFrontï¼‰
   - Lazy Loadingï¼ˆå¿…è¦ãªæ–‡ã ã‘å…ˆèª­ã¿ï¼‰

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæœ€é©åŒ–**
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¿½åŠ 
   - N+1å•é¡Œã®å›é¿

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

1. **Row Level Securityï¼ˆRLSï¼‰**
   - å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§æœ‰åŠ¹åŒ–
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

2. **API Rate Limiting**
   - FastAPIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ç¶­æŒ
   - Supabaseå´ã§ã‚‚è¨­å®šå¯èƒ½

---

## æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã®å‚ç…§æ–¹æ³•

### ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ´»ç”¨

1. **ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚**
   - `docs/FUTURE_EXPANSION_PLAN.md`ã‚’èª­ã‚€
   - ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’ç¢ºèª

2. **å®Ÿè£…æ™‚**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
   - å®Ÿè£…ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’å‚è€ƒã«ã™ã‚‹

3. **åˆ¤æ–­æ™‚**
   - ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’ç¢ºèª
   - ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šã‚’å‚ç…§

---

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2025-11-05 | 1.0 | åˆç‰ˆä½œæˆ |

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²åŒ–ã«åˆã‚ã›ã¦éšæ™‚æ›´æ–°ã—ã¦ãã ã•ã„ã€‚**
