# TODO

最終更新: 2025-10-22

## 🔴 最優先（次のセッション開始時）

### ユーザビリティ改善 - フェーズ1（即時改善）

**目標**: 高校生が使える最低限の日本語化と視覚的フィードバック
**期待効果**: タスク完了率+35%, 初回離脱率-40%
**参照**: [docs/USABILITY_REPORT.md](../USABILITY_REPORT.md)

- [ ] **1. 日本語UI対応（全画面）**
  - [ ] App.tsx: ヘッダー、エラーバナー、ウェルカムメッセージ
  - [ ] ImageUpload: アップロードプロンプト、進捗メッセージ
  - [ ] TextEditor: ヘッダー、プレースホルダー、ボタン
  - [ ] AudioPlayer: ヘッダー、コントロールボタン、ポーズ設定
  - 所要時間: 1-2時間
  - ROI: ⭐⭐⭐⭐⭐

- [ ] **2. TTS生成の進捗バー**
  - [ ] バックエンド: 進捗コールバック実装（/api/tts-with-timings）
  - [ ] フロントエンド: プログレスバーコンポーネント作成
  - [ ] 進捗表示: "15 / 20 文を生成中..."
  - [ ] 予想残り時間: "あと約20秒"
  - 所要時間: 2-3時間
  - ROI: ⭐⭐⭐⭐⭐

- [ ] **3. エラーメッセージの具体化**
  - [ ] 画像処理エラー: サイズ、形式、接続の確認手順
  - [ ] TTS生成エラー: 文字数、接続の確認手順
  - [ ] OCRエラー: 画像品質、形式の確認手順
  - 所要時間: 1-2時間
  - ROI: ⭐⭐⭐⭐

- [ ] **4. 速度プリセット1.5x, 2.0x追加**
  - [ ] AudioPlayer: プリセットボタンを5つに変更
  - [ ] レイアウト調整（横並び維持）
  - 所要時間: 30分
  - ROI: ⭐⭐⭐⭐

- [ ] **5. 文字数制限の明示**
  - [ ] TextEditor: "350 / 100,000 文字"表示
  - [ ] 90,000文字超: 黄色警告
  - [ ] 100,000文字超: 赤色警告
  - 所要時間: 30分
  - ROI: ⭐⭐⭐

- [ ] **6. アップロード前の制限警告**
  - [ ] ImageUpload: 最大10枚の明示
  - [ ] 11枚選択時: 即座に警告ダイアログ
  - 所要時間: 1時間
  - ROI: ⭐⭐⭐⭐

**フェーズ1合計**: 6-9時間

---

### 生徒向け使用ガイド作成

- [x] **USER_GUIDE.md作成** ✅
  - [x] アプリURL（https://tts-app-ycaz.vercel.app）と概要
  - [x] 基本的な使い方（画像アップロード→OCR→TTS→再生）
  - [x] 各機能の説明（速度調整、ポーズ機能、文ナビゲーション）
  - [x] トラブルシューティング（よくある問題と解決方法）
  - 所要時間: 30分（実績: 15分）

### デプロイ関連（✅ 完了）

- [x] **Railwayへのバックエンドデプロイ** ✅
  - [x] Railwayアカウント作成
  - [x] プロジェクト作成とGitHub連携
  - [x] 環境変数設定（GEMINI_API_KEY, OPENAI_API_KEY）
  - [x] デプロイ実行とURL確認
  - [x] ffmpegインストール設定（aptfile）
  - [x] クロスプラットフォーム対応（openai_service.py）
  - [x] google-generativeai依存関係追加

- [x] **Vercelへのフロントエンドデプロイ** ✅
  - [x] Vercelアカウント作成
  - [x] プロジェクトインポートとGitHub連携
  - [x] 環境変数設定（VITE_API_BASE_URL）
  - [x] デプロイ実行とURL確認
  - [x] TypeScriptビルドエラー修正

- [x] **Railwayポート設定とCORSエラー解決** ✅（セッション#11）
  - [x] GitHubへ最新コードをプッシュ
  - [x] Railway Settings → Networking → Port = 8080に設定
  - [x] Railwayの自動再デプロイ確認
  - [x] CORS設定の検証（Preflightリクエスト確認）

- [x] **E2E動作確認** ✅（セッション#11）
  - [x] 画像アップロード → OCR
  - [x] TTS音声生成
  - [x] 音声再生、速度調整、ポーズ機能
  - [x] ブラウザコンソールでエラーがないことを確認

## 🟡 高優先度

### ユーザビリティ改善 - フェーズ2（使いやすさ向上）

**目標**: 機能発見率とモバイル体験の改善
**期待効果**: 機能利用率+50%, モバイル完了率+25%, 満足度+35%
**参照**: [docs/USABILITY_REPORT.md](../USABILITY_REPORT.md)

- [ ] **7. 初回チュートリアル/ツールチップ**
  - [ ] Tutorialコンポーネント作成（オーバーレイ式）
  - [ ] 3ステップガイド実装
  - [ ] localStorage で初回フラグ管理
  - [ ] 各機能に「？」アイコン追加
  - 所要時間: 3-4時間
  - ROI: ⭐⭐⭐⭐⭐

- [ ] **8. 画像の個別削除機能**
  - [ ] プレビュー画像に「×」ボタン追加
  - [ ] 削除後の自動再OCR実装
  - [ ] フェードアウトアニメーション
  - 所要時間: 2-3時間
  - ROI: ⭐⭐⭐⭐

- [ ] **9. モバイルUI最適化**
  - [ ] シークバー高さ: 4px → 16px（スマホ時）
  - [ ] コントロールボタン: 24px → 44px（スマホ時）
  - [ ] プレイヤー固定ヘッダー化（縦画面）
  - [ ] タップエリア拡大
  - 所要時間: 3-4時間
  - ROI: ⭐⭐⭐⭐

- [ ] **10. キーボードショートカット**
  - [ ] スペースキー: 再生/一時停止
  - [ ] 左右矢印: 前/次の文
  - [ ] 上下矢印: 速度調整
  - [ ] 「？」キー: ショートカット一覧表示
  - 所要時間: 2-3時間
  - ROI: ⭐⭐⭐

**フェーズ2合計**: 10-14時間

---

### 基本実装（完了）

- [x] バックエンドの基本セットアップ ✅
- [x] バックエンドAPI実装 ✅
- [x] バックエンドのテスト実装 ✅
- [x] Gemini OCR統合 ✅
- [x] OpenAI TTS統合 ✅
- [x] エンドツーエンド統合テスト ✅

### 新機能実装

- [x] 複数画像アップロード機能実装 ✅
  - [x] バックエンド: OCRエンドポイント拡張（複数画像対応）
  - [x] バックエンド: 画像結合ロジック実装
  - [x] フロントエンド: 複数ファイル選択UI
  - [x] フロントエンド: アップロード進捗表示

- [x] AudioPlayer拡張機能実装 ✅
  - [x] テキスト解析: 文の境界検出ロジック実装
  - [x] 文ごとのポーズ挿入機能（0-5秒、0.5秒刻み）
  - [x] 文ごとのナビゲーション（前/次スキップボタン）
  - [x] シークバー上の文境界マーカー表示
  - [x] シークバーツールチップ（文の先頭5-10単語表示）
  - [x] ポーズ設定UI（有効/無効切り替え、秒数スライダー）

- [x] 正確なタイムスタンプ機能実装 ✅
  - [x] バックエンド: 文ごとのTTS生成（generate_speech_with_timings）
  - [x] バックエンド: pydubによる正確な音声長測定
  - [x] バックエンド: /api/tts-with-timings エンドポイント追加
  - [x] フロントエンド: performTTSWithTimings API関数
  - [x] フロントエンド: AudioPlayerの3段階タイムスタンプ精度システム

- [x] タイムスタンプ精度の改善（セッション#8） ✅
  - [x] ffmpegの自動検知機能実装
  - [x] opus → mp3フォーマット変更（ffmpeg互換性対応）
  - [x] 連結後の実際の長さで比例補正
  - [x] 文間に200msの無音挿入
  - [x] ポーズロジックの改善（シーク機能追加）
  - [ ] **ポーズ前の音被り問題（未完全解決）**

## 🟢 中優先度（生徒フィードバック後に実施）

### 機能改善

- [ ] **ポーズ前の音被り問題の完全解決**
  - **現状**: 200msの無音を挿入したが、まだポーズ前に次の文の一瞬の音が聞こえる
  - **対策1**: ポーズ検知タイミングを0.1秒 → 0.25秒または0.3秒前に早める
  - **対策2**: 無音期間を200ms → 300msまたは400msに延長
  - **対策3**: ポーズロジックの最適化（シーク操作を即座に実行、状態管理改善）
  - **対策4**: 代替アプローチ（Web Audio API使用）の検討
  - **ファイル**: `frontend/src/components/features/AudioPlayer/AudioPlayer.tsx`
  - 所要時間: 1-2時間

- [ ] Error loading audioエラーの調査
  - **現状**: 詳細なエラーログを追加したが、まだ原因不明
  - **次回**: エラーログの詳細（code, message, networkState, readyState）を確認
  - **ファイル**: `frontend/src/components/features/AudioPlayer/AudioPlayer.tsx`
  - 所要時間: 30分

- [ ] パフォーマンステストとUI改善
  - [ ] 5文、10文、20文での生成時間測定
  - [ ] TTS生成の進捗表示UI追加
  - [ ] ローディング状態の改善
  - [ ] タイムアウト処理の確認
  - 所要時間: 1時間

- [ ] OCR精度の評価とチューニング
  - [ ] 様々な画像タイプでOCR精度を確認
  - [ ] 手書き除外機能のテスト
  - [ ] 多言語対応の確認
  - [ ] プロンプトの最適化（必要に応じて）
  - 所要時間: 30分

### パフォーマンス最適化

- [x] フロントエンド基本機能実装 ✅
- [x] サービス層実装 ✅
- [x] 音程保持機能実装（HTML5 Audio API） ✅

- [ ] IndexedDBキャッシュ実装（オプション）
  - [ ] 画像キャッシュ機能
  - [ ] 音声キャッシュ機能
  - [ ] キャッシュ管理UI
  - 所要時間: 2時間

- [ ] TTS生成の最適化
  - [ ] キャッシュ機構（同じテキストの再生成を避ける）
  - [ ] 長文（30文以上）のパフォーマンス改善
  - 所要時間: 1.5時間

## 🔵 低優先度

- [ ] PWA対応
  - [ ] Service Worker実装
  - [ ] manifest.json設定
  - [ ] オフライン対応
  - 所要時間: 2時間

- [ ] フロントエンドテスト実装
  - [ ] ユニットテスト
  - [ ] E2Eテスト
  - 所要時間: 2時間

- [ ] デプロイ設定
  - [ ] Vercel設定
  - [ ] Railway設定
  - [ ] CI/CD設定
  - 所要時間: 1時間

## 📝 備考

**次回セッションで参照すべきファイル:**
- `backend/app/services/openai_service.py` - TTS生成ロジック、pydub使用
- `backend/app/api/routes/tts.py` - /api/tts-with-timings エンドポイント
- `frontend/src/components/features/AudioPlayer/AudioPlayer.tsx` - タイムスタンプ使用ロジック

**次回セッション前の準備:**
- [ ] ffmpegがインストールされているか確認（`ffmpeg -version`）
  - Windowsの場合: https://ffmpeg.org/download.html からダウンロードしてPATHに追加
  - macOS: `brew install ffmpeg`
  - Linux: `sudo apt-get install ffmpeg`
- [ ] ブラウザのデベロッパーツールを開いてコンソールエラーを確認できる状態にする

**技術メモ:**
- pydubはffmpegに依存（音声ファイルの長さ測定に必要）
- 文ごとのTTS生成により、API使用量が増加（文数 × API呼び出し）
- タイムスタンプ精度: 95-99%（推定: 70-85%）
